---
title: "R Notebook"
output: html_notebook
---

## Bibliotecas

Bastante utilizada, no geral, os gráficos são mais bonitos (fica como alternativa caso sobre tempo).

```{r}

library(ggplot2)

```

Biblioteca que encontrei para realizar consultas, lembrando SQL, em dados.

Uso principal para realizar operações do tipo GROUP_BY.

```{r}

library(tidyverse)

```

Biblioteca com diversas paletas de cores para deixar os gráficos mais bonitos.

```{r}

library(RColorBrewer)

```

## Banco de Dados

Carregando o banco de dados.

```{r}

dataset = read.csv("../enem_2018_small_3.csv", header = TRUE)

```

Listando as colunas contidas no banco de dados.

```{r}

names(dataset)

```

Substituição de todos os campos em branco (NULL) por 0.

```{r}

dataset[is.na(dataset)] = 0

```

Listando as cinco primeiras linhas do banco de dados.

```{r}

head(dataset)

```

## Pré-processamentos

Abaixo, geramos um subconjunto contendo apenas as entradas de alunos que realizaram todas as provas (uma filtragem).

```{r}

fdata = subset(
  dataset, 
  TP_PRESENCA_CN == 1 & 
    TP_PRESENCA_CH == 1 & 
    TP_PRESENCA_LC == 1 & 
    TP_PRESENCA_MT == 1 & 
    TP_PRESENCA_MT == 1
  )

head(fdata)

```

## Análise das Notas por Sexo

### Preparando os Dados

Agrupamos os dados pelo gênero (M e F) e depois calculamos as médias das notas para cada área do conhecimento.

```{r}

sex_gb_data = 
  fdata %>% 
  group_by(TP_SEXO) %>%
  summarise(
    NOTA_CN_MEAN = sum(NU_NOTA_CN)/n(), 
    NOTA_CH_MEAN = sum(NU_NOTA_CH)/n(), 
    NOTA_LC_MEAN = sum(NU_NOTA_LC)/n(), 
    NOTA_MT_MEAN = sum(NU_NOTA_MT)/n(), 
    NOTA_RD_MEAN = sum(NU_NOTA_REDACAO)/n()
  )

head(sex_gb_data)

```

### Gerando o Gráfico

Agora, que já temos os dados necessários, precisamos formatar eles para facilitar o uso com a função que gerará o gráfico. 

O ideal seria utilizar alguma função para realizar a formatação mas, para agilizar e evitar estresse, iremos fazer manualmente.

```{r}

sex_gb_data_fmt = data.matrix(read.table(text = "
     M         F
  0  577.0799  566.4753
  1  560.2741  518.3447
  2  532.5310  525.7392
  3  510.8027  519.6946
  4  500.6476  488.9929
  ", header = TRUE))

areas_names = as.vector(c(
  "C. Humanas ",
  "Matemática ", 
  "Linguagens ", 
  "Redação ",
  "C. da Natureza " 
  ))

sex_gb_data_fmt

```

Código para gerar o gráfico (o bloco abaixo precisa ser executado de uma vez, por completo).

```{r}

# Ajusta as dimensões do retângulo sobre o qual o gráfico é desenhado.
# Isto é necessário para que os títulos dispostos ao longo do eixo Y fiquem visíveis.

par(mar = c(4, 8, 4, 3))

# Criamos dois vetores, um com as médias dos homens e outro com as médias das mulheres.
# Apenas para facilitar passar os dados para a função que desenha o gráfico

m_data = sex_gb_data_fmt[,"M"]
f_data = sex_gb_data_fmt[,"F"]

# Intervalo com a menor e maior média.

grades_range = range(c(m_data, f_data))

# Gera o gráfico sem as linhas, legendas e o grid.

plot(
  grades_range, 
  c(1, 5), 
  type = "n",
  xaxs = "i",
  yaxt = "n",
  main = "Desempenho das Disciplinas por Área e Sexo", 
  xlab = "Média das Notas",
  ylab = "",
  xlim = c(400, 700)
  ) 

# Desenha as duas linhas (homes e mulheres).

lines(m_data, c(1:5), type = "o", lwd = 2, col = "blue") 
lines(f_data, c(1:5), type = "o", lwd = 2, col = "red")

# Adiciona o grid e dispõe o texto ao longo do eixo Y.

grid (NULL, NULL, lty = 6, col = "cornsilk2") 
axis(2, at = c(1:5), labels = FALSE)
text(y = c(1:5), par("usr")[1], labels = areas_names, srt = 0, pos = 2, xpd = TRUE)

# Adiciona a legenda das linhas.

legend("topright", lty = "solid", lwd = 2, col=c("blue", "red"), legend = c("Homens", "Mulheres"))

```

## Análise das Notas por Região

### Preparando os Dados

Agrupamos os dados por região (N, NE, SE, S e MW) e depois calculamos as médias das notas para cada área do conhecimento.

```{r}

# Agrupa os dados.

region_gb_data = 
  fdata %>% 
  group_by(CO_REGIAO_RESIDENCIA)%>% 
  summarise(
    NOTA_CN_MEAN = sum(NU_NOTA_CN)/n(),
    NOTA_CH_MEAN = sum(NU_NOTA_CH)/n(),
    NOTA_LC_MEAN = sum(NU_NOTA_LC)/n(),
    NOTA_MT_MEAN = sum(NU_NOTA_MT)/n(),
    NOTA_RD_MEAN = sum(NU_NOTA_REDACAO)/n()
  )

# Substitui a codificacão numérica pelo nome de cada região.

region_gb_data$CO_REGIAO_RESIDENCIA = factor(
  region_gb_data$CO_REGIAO_RESIDENCIA, 
  levels = c(1, 2, 3, 4, 5), 
  labels=c("NORTE", "NORDESTE", "SUDESTE", "SUL", "CENTRO-OESTE")
  )

# Listando o resultado obtido.

region_gb_data

```

### Gerando o Gráfico

Agora, que já temos os dados necessários, precisamos formatar eles para facilitar o uso com a função que gerará o gráfico. 

O ideal seria utilizar alguma função para realizar a formatação mas, para agilizar e evitar estresse, iremos fazer manualmente.

```{r}

region_gb_data_fmt = data.matrix(read.table(text = "
                CN        CH        LC        MT        RD
  NORTE         473.8624	548.3448	505.6513	505.2629	480.2929
  NORDESTE      480.9937	556.4959	513.9111	520.2293	500.9236
  SUDESTE       508.3383	586.6912	544.9365	556.2115	540.1123
  SUL	          504.4326	586.9306	542.8668	547.8609	523.2844
  CENTRO-OESTE	494.8638	568.8757	528.2555	531.4668	511.0313
  ", header = TRUE))

region_gb_data_fmt

```

Código para gerar o gráfico (o bloco abaixo precisa ser executado de uma vez, por completo).

```{r}

par(mar = c(5,4,4,10))

barplot(
  region_gb_data_fmt, 
  main = "Média das Notas por Região", 
  xlab = "Área do Conhecimento",
  ylab = "Média das Notas",
  col=brewer.pal(nrow(region_gb_data_fmt), "Paired"),
  names.arg = c("C. da Natureza", "C. Humanas", "Linguagens", "Matemática", "Redação"),
  cex.names = 0.70,
  ylim = c(400, 600),
  beside = TRUE,
  legend = rownames(region_gb_data_fmt),
  args.legend = list(x ='right', bty='n', inset=c(-0.39,0), xpd = TRUE),
  xpd = FALSE
  )

```

## Análise das Notas por Anos pós Formatura no Ensino Médio

### Preparando os Dados

Abaixo, geramos um subconjunto contendo apenas as entradas de alunos que realizaram todas as provas e informaram o ano de conclusão do ensino médio (uma filtragem).

```{r}

cfdata = subset(
  dataset, 
  TP_PRESENCA_CN == 1 & 
    TP_PRESENCA_CH == 1 & 
    TP_PRESENCA_LC == 1 & 
    TP_PRESENCA_MT == 1 & 
    TP_PRESENCA_MT == 1 & 
    TP_ANO_CONCLUIU > 0
  )

```

Agrupamos os dados pelo número de anos desde a conclusão do ensino médio e depois calculamos as médias das notas para cada área do conhecimento.

```{r}

em_gp_data = 
  cfdata %>% 
  group_by(TP_ANO_CONCLUIU) %>% 
  summarise(
    NOTA_CN_MEAN = sum(NU_NOTA_CN)/n(),
    NOTA_CH_MEAN = sum(NU_NOTA_CH)/n(),
    NOTA_LC_MEAN = sum(NU_NOTA_LC)/n(),
    NOTA_MT_MEAN = sum(NU_NOTA_MT)/n(),
    NOTA_RD_MEAN = sum(NU_NOTA_REDACAO)/n()
    )

em_gp_data

```


### Gerando o Gráfico

Agora, que já temos os dados necessários, precisamos formatar eles para facilitar o uso com a função que gerará o gráfico. 

O ideal seria utilizar alguma função para realizar a formatação mas, para agilizar e evitar estresse, iremos fazer manualmente.

```{r}

em_gp_data_fmt = data.matrix(read.table(text = "
                  1        2        3        4        5        6        7        8        9        10       11       >11
  CDNATUREZA      498.4525 498.4684 496.2037 495.3493 494.1237 492.4198 493.0256 491.1260 491.9990 493.8888 491.2914 493.8732
  CHUMANAS        573.7264 574.1270 572.7351 573.8095 574.3243 574.8060 576.9054 574.6819 576.4254 578.0239 576.7493 582.2480
  LINGUAGENS      532.8030 533.5877 531.7910 532.5863 532.1315 531.4086 532.5693 528.6013 529.2636 529.0768 525.8270 523.8404
  MATEMÁTICA      541.5357 541.5881 538.6611 534.6175 534.6175 532.2354 532.4638 526.9232 525.4294 525.1752 521.4379 515.9948
  REDAÇÃO   	    544.5676 539.9269 529.9921 521.5879 511.9225 503.4143 500.5351 488.7527 487.9442 486.4491 479.2771 466.5754
  ", header = TRUE))

em_gp_data_fmt = em_gp_data_fmt * 0.2

```

Código para gerar o gráfico (o bloco abaixo precisa ser executado de uma vez, por completo).

```{r}

par(mar = c(5, 4 , 4, 10))

barplot(
  em_gp_data_fmt, 
  main="Média das Notas por Anos pós Formatura no Ensino Médio",
  xlab="Número de Anos", 
  ylab = "Média das Notas",
  col=brewer.pal(nrow(em_gp_data_fmt), "Paired"),
  names.arg = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", ">11"),
  legend = c("C. da Natureza", "C. Humanas", "Linguagens", "Matemática", "Redação"),
  cex.names = 0.9,
  ylim = c(0, 600),
  args.legend = list(x ='right', bty='n', inset=c(-0.39,0), xpd = TRUE),
  xpd = FALSE
  )

```

## ...

### Preparando os Dados

Agrupamos os dados pela escolaridade dos pais (A..G) e depois calculamos as médias das notas para cada área do conhecimento.

```{r}

# Agrupa os dados.

father_gb_data = 
  fdata %>% 
  group_by(Q001)%>% 
  summarise(NOTA_MEAN = (sum(NU_NOTA_CN+NU_NOTA_CH+NU_NOTA_LC+NU_NOTA_MT+NU_NOTA_REDACAO)/5)/n()
  )

mother_gb_data = 
  fdata %>% 
  group_by(Q002)%>% 
  summarise(NOTA_MEAN = (sum(NU_NOTA_CN+NU_NOTA_CH+NU_NOTA_LC+NU_NOTA_MT+NU_NOTA_REDACAO)/5)/n()
  )

# Removemos as entradas para as quais o candidato desconhece a escolaridade da mãe ou pai.

father_gb_data = father_gb_data[-c(8),]
mother_gb_data = mother_gb_data[-c(8),]

father_gb_data
mother_gb_data

```

### Gerando o Gráfico

Agora, que já temos os dados necessários, precisamos formatar eles para facilitar o uso com a função que gerará o gráfico. 

O ideal seria utilizar alguma função para realizar a formatação mas, para agilizar e evitar estresse, iremos fazer manualmente.

```{r}

parents_gb_data_fmt = data.matrix(read.table(text = "
     F         M
  0  610.2344  590.4543
  1  592.5938  578.8811
  2  544.3216  535.8166
  3  524.8589  516.2735
  4  514.5845  507.8539
  5  499.0910  494.4802
  6  479.4759  474.9720
  ", header = TRUE))

education_names = as.vector(c(
  "Pós-graduação ",
  "Educação Superior ", 
  "Ensino Médio ", 
  "8ª/9º Ano Completo ",
  "4ª/5º Ano Completo ",
  "4ª/5º Ano Incompleto ", 
  "Nunca Estudou "
  ))

parents_gb_data_fmt

```

Código para gerar o gráfico (o bloco abaixo precisa ser executado de uma vez, por completo).

```{r}

# Ajusta as dimensões do retângulo sobre o qual o gráfico é desenhado.
# Isto é necessário para que os títulos dispostos ao longo do eixo Y fiquem visíveis.

par(mar = c(4, 10, 4, 3))

# Criamos dois vetores, um com as médias dos pais e outro com as médias das mães.
# Apenas para facilitar passar os dados para a função que desenha o gráfico

f_data = parents_gb_data_fmt[,"F"]
m_data = parents_gb_data_fmt[,"M"]

# Intervalo com a menor e maior média.

grades_range = range(c(f_data, m_data))

# Gera o gráfico sem as linhas, legendas e o grid.

plot(
  grades_range, 
  c(1, 7), 
  type = "n",
  xaxs = "i",
  yaxt = "n",
  main = "Desempenho nas Disciplinas por Escolaridade dos Pais", 
  xlab = "Média das Notas",
  ylab = "",
  xlim = c(400, 700)
  ) 

# Desenha as duas linhas (pais e mães).

lines(f_data, c(1:7), type = "o", lwd = 2, col = "blue") 
lines(m_data, c(1:7), type = "o", lwd = 2, col = "red")

# Adiciona o grid e dispõe o texto ao longo do eixo Y.

grid (NULL, NULL, lty = 6, col = "cornsilk2") 
axis(2, at = c(1:7), labels = FALSE)
text(y = c(1:7), par("usr")[1], labels = education_names, srt = 0, pos = 2, xpd = TRUE)

# Adiciona a legenda das linhas.

legend("topright", lty = "solid", lwd = 2, col=c("blue", "red"), legend = c("Pai", "Mãe"))

```

##

### Preparando os Dados

```{r}

# Agrupa os dados.

reason_gb_data = fdata %>% group_by(TP_STATUS_REDACAO) %>% summarise(COUNT = n())

# Removemos as entradas para as quais a redação foi considerada válida.

reason_gb_data = reason_gb_data[-c(1),]

# Apresentando contagens.

reason_gb_data

```


### Gerando o Gráfico

Agora, que já temos os dados necessários, precisamos formatar eles para facilitar o uso com a função que gerará o gráfico. 

```{r}

counts = as.vector(unlist(reason_gb_data[,"COUNT"]))
percentages = round(100*counts/sum(counts), 1)
percentages = paste(percentages, "%", sep="")

labels = c(
  "Anulada", 
  "Cópia do Texto Motivador", 
  "Em Branco", 
  "Fuga do Tema", 
  "Tipo Textual Incorreto", 
  "Texto Insuficiente", 
  "Parte Desconectada"
  )

counts
percentages

```

Código para gerar o gráfico (o bloco abaixo precisa ser executado de uma vez, por completo).

```{r}

#par(mfrow=c(1, 2), mai = c(1, 0, 1, 0))

par(mar = c(0, 0, 4, 14))

pie(
  counts, 
  labels = percentages, 
  main = "Ocorrências de Falha na Redação", 
  col = brewer.pal(length(counts), "Paired")
  )

legend(
  "topright", 
  labels,
  fill = brewer.pal(length(counts), "Paired"),
  inset=c(-0.5, 0),
  xpd = TRUE
  )

```














```{r}

```

